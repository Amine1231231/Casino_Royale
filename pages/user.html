<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Casino Royale - User</title>
<link rel="stylesheet" href="../styles/style.css">
<style>
  body{color:white} .user-container{padding-top:120px;min-height:100vh;display:flex;flex-direction:column;align-items:center}
  .auth-section,.auth-form,.players-section,.players-grid,.player-card{display:flex;flex-direction:column;align-items:center}
  .auth-section{gap:3rem;margin-bottom:3rem;flex-wrap:wrap}
  .auth-form,.player-card{background:rgba(255,255,255,.1);border:1px solid rgba(255,255,255,.2);border-radius:15px;padding:2rem;box-shadow:0 10px 30px rgba(0,0,0,.2);transition:.3s;width:300px}
  .auth-form:hover,.player-card:hover{transform:translateY(-5px);box-shadow:0 20px 40px rgba(0,0,0,.3)}
  .auth-form h2{margin-bottom:1rem;text-align:center}
  .form-group{margin-bottom:1rem;width:100%} .form-group label{display:block;margin-bottom:.5rem}
  .form-group input{width:100%;padding:.8rem;border:1px solid rgba(255,255,255,.3);border-radius:10px;background:rgba(255,255,255,.1);color:white}
  .auth-btn,.logout-btn{padding:1rem;border:none;border-radius:10px;color:white;font-weight:bold;cursor:pointer;transition:.3s;width:100%;margin-top:1rem}
  .auth-btn{background:linear-gradient(45deg,#667eea,#764ba2)} .logout-btn{background:linear-gradient(45deg,#f5576c,#f093fb)}
  .player-status{padding:.3rem 1rem;border-radius:20px;font-size:.9rem} .online{background:linear-gradient(45deg,#4facfe,#00f2fe)} .offline{background:linear-gradient(45deg,#666,#999)}
  .error-message,.success-message{padding:1rem;border-radius:10px;margin-bottom:1rem;text-align:center}
  .error-message{background:rgba(245,87,108,.2);border:1px solid rgba(245,87,108,.5);color:#f5576c}
  .success-message{background:rgba(79,172,254,.2);border:1px solid rgba(79,172,254,.5);color:#4facfe}
  .players-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(250px,1fr));gap:1rem;width:100%;max-width:1000px}
  @media(max-width:768px){.auth-section{flex-direction:column;gap:2rem}}
</style>
</head>
<body>
<div class="particles"><div class="particle"></div><div class="particle"></div><div class="particle"></div><div class="particle"></div><div class="particle"></div><div class="particle"></div></div>
<header><div class="container"><nav><ul>
<li><a href="../index.html">Home</a></li>
<li><a href="user.html" class="active">User</a></li>
<li><a href="tournament.html">Tournament</a></li>
<li><a href="bet.html">Bet</a></li>
<li><a href="results.html">Results</a></li>
</ul></nav></div></header>

<div class="user-container">
  <div id="authSection" class="auth-section">
    <form id="registerForm" class="auth-form" data-action="register">
      <h2>Create Account</h2>
      <div class="error-message" style="display:none"></div>
      <div class="success-message" style="display:none"></div>
      <div class="form-group"><label>Name:<input name="name" required></label></div>
      <div class="form-group"><label>Clash ID:<input name="clashId" required></label></div>
      <div class="form-group"><label>Password:<input type="password" name="password" required></label></div>
      <button class="auth-btn">Create Account</button>
    </form>
    <form id="loginForm" class="auth-form" data-action="login">
      <h2>Log In</h2>
      <div class="error-message" style="display:none"></div>
      <div class="success-message" style="display:none"></div>
      <div class="form-group"><label>Name:<input name="name" required></label></div>
      <div class="form-group"><label>Password:<input type="password" name="password" required></label></div>
      <button class="auth-btn">Log In</button>
    </form>
  </div>

  <div id="playersSection" class="players-section" style="display:none">
    <h2>Online Players</h2>
    <p>Welcome, <span id="currentUserName"></span>!</p>
    <button class="logout-btn" id="logoutBtn">Logout</button>
    <div id="playersGrid" class="players-grid"></div>
  </div>
</div>

<script>
const API='https://script.google.com/macros/s/AKfycbwORRnsi7rkr-lN_j810YIu6KoFcqKA6Pw1R75fiK-ZdzjPSHUfBr1nhP3LhsyjuXNpZA/exec';
let user=JSON.parse(localStorage.getItem('user')||'null');
if(user)showPlayers();

document.querySelectorAll('form').forEach(f=>f.addEventListener('submit',async e=>{
  e.preventDefault();
  const btn=f.querySelector('button'),err=f.querySelector('.error-message'),succ=f.querySelector('.success-message');
  [err,succ].forEach(m=>m.style.display='none');
  btn.disabled=true;
  const data=Object.fromEntries(new FormData(f)),res=await fetch(API,{method:'POST',body:new URLSearchParams({...data,action:f.dataset.action})});
  const json=await res.json();
  btn.disabled=false;
  if(json.success){
    if(f.dataset.action==='login'){user={name:json.name,clashId:json.clashId};localStorage.setItem('user',JSON.stringify(user));showPlayers();}
    else f.reset();
    succ.textContent=json.message||'Success'; succ.style.display='block';
  }else{err.textContent=json.message||'Error'; err.style.display='block';}
}));

document.getElementById('logoutBtn').onclick=async()=>{
  await fetch(API,{method:'POST',body:new URLSearchParams({action:'logout',name:user.name})});
  localStorage.removeItem('user'); user=null; document.getElementById('playersSection').style.display='none';document.getElementById('authSection').style.display='flex';
};

async function loadPlayers(){
  const res=await fetch(API+'?action=getPlayers'),json=await res.json();
  document.getElementById('playersGrid').innerHTML=json.success?json.players.map(p=>`
    <div class="player-card">
      <div>${p.name}</div>
      <div>Clash ID: ${p.clashId}</div>
      <div class="player-status ${p.status.toLowerCase()}">${p.status}</div>
    </div>`).join(''):'<div>Error loading players</div>';
}

function showPlayers(){
  document.getElementById('authSection').style.display='none';
  document.getElementById('playersSection').style.display='flex';
  document.getElementById('currentUserName').textContent=user.name;
  loadPlayers(); setInterval(loadPlayers,30000);
}
</script>
</body>
</html>
