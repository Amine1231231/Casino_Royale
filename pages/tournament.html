<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>League Manager</title>
  <link rel="stylesheet" href="../styles/style.css" />
  <style>
    /* Additional styles specific to this page */
    .page-section {
      display: none;
      animation: fadeIn 0.5s ease;
    }

    .page-section.active {
      display: block;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .welcome-section {
      text-align: center;
      color: white;
      margin-bottom: 3rem;
      padding-top: 2rem;
    }

    .welcome-section h1 {
      font-size: 3rem;
      margin-bottom: 1rem;
      text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
    }

    .welcome-section p {
      font-size: 1.2rem;
      opacity: 0.9;
    }

    .output {
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 8px;
      padding: 1rem;
      font-family: 'Courier New', monospace;
      font-size: 0.9rem;
      max-height: 400px;
      overflow-y: auto;
      white-space: pre-wrap;
      word-wrap: break-word;
      color: white;
    }

    .grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 2rem;
      max-width: 1200px;
      margin: 0 auto;
    }

    .nav-brand {
      font-size: 1.5rem;
      font-weight: bold;
      color: white;
      position: absolute;
      left: 2rem;
      top: 50%;
      transform: translateY(-50%);
    }

    @media (max-width: 768px) {
      .grid {
        grid-template-columns: 1fr;
      }
      
      .welcome-section h1 {
        font-size: 2rem;
      }

      .nav-brand {
        position: static;
        transform: none;
        text-align: center;
        margin-bottom: 1rem;
      }
    }
  </style>
</head>
<body>
  <!-- Floating Particles -->
  <div class="particles">
    <div class="particle" style="left: 10%; top: 20%; animation-delay: 0s;"></div>
    <div class="particle" style="left: 20%; top: 80%; animation-delay: 1s;"></div>
    <div class="particle" style="left: 30%; top: 40%; animation-delay: 2s;"></div>
    <div class="particle" style="left: 40%; top: 70%; animation-delay: 3s;"></div>
    <div class="particle" style="left: 50%; top: 30%; animation-delay: 4s;"></div>
    <div class="particle" style="left: 60%; top: 60%; animation-delay: 5s;"></div>
    <div class="particle" style="left: 70%; top: 10%; animation-delay: 0.5s;"></div>
    <div class="particle" style="left: 80%; top: 50%; animation-delay: 1.5s;"></div>
    <div class="particle" style="left: 90%; top: 90%; animation-delay: 2.5s;"></div>
  </div>

  <header>
    <div class="container">
      <div class="nav-brand">League Manager</div>
      <nav>
        <ul>
          <li><a href="#" data-page="home" class="nav-link active">Home</a></li>
          <li><a href="#" data-page="tournament" class="nav-link">League</a></li>
          <li><a href="#" data-page="bet" class="nav-link">Bet</a></li>
          <li><a href="#" data-page="results" class="nav-link">Results</a></li>
        </ul>
      </nav>
    </div>
  </header>

  <main class="user-container">
    <!-- Home Section -->
    <section id="home" class="page-section active">
      <div class="welcome-section">
        <h1>Welcome to League Manager</h1>
        <p>Manage your tournaments, place bets, and track results all in one place</p>
      </div>
      <div class="form-card">
        <h2>Getting Started</h2>
        <p style="text-align: center; color: rgba(255, 255, 255, 0.8); margin-bottom: 2rem;">
          Click on "League" in the navigation above to create a new tournament or manage existing ones.
        </p>
        <div style="text-align: center;">
          <button class="btn btn-primary" onclick="showPage('tournament')">Create New League</button>
        </div>
      </div>
    </section>

    <!-- Tournament Section -->
    <section id="tournament" class="page-section">
      <div class="welcome-section">
        <h1>League Management</h1>
        <p>Create and manage your tournaments</p>
      </div>
      
      <div class="grid">
        <div class="form-card">
          <h2>Create New Tournament</h2>
          <div class="form-group">
            <input type="text" id="leagueName" placeholder="League Name" />
          </div>
          <div class="form-group">
            <input type="text" id="players" placeholder="Players (comma separated)" />
          </div>
          <button id="createBtn" class="btn btn-primary" style="width: 100%;">Create League</button>
          <p id="message" class="message hidden"></p>
        </div>

        <div class="form-card">
          <h2>League Data</h2>
          <button id="loadBtn" class="btn btn-secondary" style="width: 100%; margin-bottom: 1rem;">Load League Rounds</button>
          <div id="leagueOutput" class="output" style="min-height: 200px;">Click "Load League Rounds" to view tournament data...</div>
        </div>
      </div>
    </section>

    <!-- Bet Section -->
    <section id="bet" class="page-section">
      <div class="welcome-section">
        <h1>Betting</h1>
        <p>Place your bets on upcoming matches</p>
      </div>
      <div class="form-card">
        <h2>Coming Soon</h2>
        <p style="text-align: center; color: #666;">Betting functionality will be available soon.</p>
      </div>
    </section>

    <!-- Results Section -->
    <section id="results" class="page-section">
      <div class="welcome-section">
        <h1>Results</h1>
        <p>View tournament results and statistics</p>
      </div>
      <div class="form-card">
        <h2>Coming Soon</h2>
        <p style="text-align: center; color: #666;">Results functionality will be available soon.</p>
      </div>
    </section>
  </main>

  <script>
    const SCRIPT_URL =
      "https://script.google.com/macros/s/AKfycbyqKp7RgGbE-NhVqTILvSs-GTVYoulN5u7FKQ-FfaXxbr0DAsrzNPj0zrvQD92iTQFqzQ/exec";

    // Navigation functionality
    function showPage(pageId) {
      // Hide all sections
      document.querySelectorAll('.page-section').forEach(section => {
        section.classList.remove('active');
      });
      
      // Show selected section
      document.getElementById(pageId).classList.add('active');
      
      // Update navigation active state
      document.querySelectorAll('.nav-link').forEach(link => {
        link.classList.remove('active');
      });
      
      document.querySelector(`[data-page="${pageId}"]`).classList.add('active');
    }

    // Add click listeners to navigation links
    document.querySelectorAll('.nav-link').forEach(link => {
      link.addEventListener('click', (e) => {
        e.preventDefault();
        const pageId = link.getAttribute('data-page');
        showPage(pageId);
      });
    });

    // API call function
    async function callAPI(action, data = {}) {
      const formData = new FormData();
      formData.append("action", action);
      for (const key in data) {
        formData.append(key, data[key]);
      }
      try {
        const res = await fetch(SCRIPT_URL, {
          method: "POST",
          body: formData,
        });
        return res.json();
      } catch (err) {
        return { success: false, message: "Connection error" };
      }
    }

    // Create league functionality
    document.getElementById("createBtn").addEventListener("click", async () => {
      const leagueName = document.getElementById("leagueName").value.trim();
      const players = document
        .getElementById("players")
        .value.split(",")
        .map((p) => p.trim())
        .filter((p) => p);
      const messageEl = document.getElementById("message");
      
      messageEl.classList.remove("error", "success", "hidden");
      
      if (!leagueName || players.length < 2) {
        messageEl.textContent = "Please enter a league name and at least 2 players.";
        messageEl.classList.add("error");
        return;
      }
      
      // Show loading state
      const createBtn = document.getElementById("createBtn");
      const originalText = createBtn.textContent;
      createBtn.textContent = "Creating...";
      createBtn.disabled = true;
      
      const result = await callAPI("createLeague", {
        leagueName,
        players: JSON.stringify(players),
      });
      
      messageEl.textContent = result.message;
      messageEl.classList.add(result.success ? "success" : "error");
      
      // Reset button
      createBtn.textContent = originalText;
      createBtn.disabled = false;
      
      // Clear form on success
      if (result.success) {
        document.getElementById("leagueName").value = "";
        document.getElementById("players").value = "";
      }
    });

    // Load league data functionality
    document.getElementById("loadBtn").addEventListener("click", async () => {
      const outputEl = document.getElementById("leagueOutput");
      const loadBtn = document.getElementById("loadBtn");
      
      // Show loading state
      const originalText = loadBtn.textContent;
      loadBtn.textContent = "Loading...";
      loadBtn.disabled = true;
      outputEl.textContent = "Loading league data...";
      
      const result = await callAPI("getLeagueRounds");
      
      if (result.success) {
        outputEl.textContent = JSON.stringify(result.data, null, 2);
      } else {
        outputEl.textContent = `Error: ${result.message}`;
      }
      
      // Reset button
      loadBtn.textContent = originalText;
      loadBtn.disabled = false;
    });
  </script>
</body>
</html>
