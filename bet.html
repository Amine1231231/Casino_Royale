<script>
  const API_BASE = "https://script.google.com/macros/s/AKfycbzjD2V8R1XrwcQfiVflSFzTweY-4WAefMyE51P7Rx8IyPQymghNetE7nNH5Ou7Ig5xaLA/exec"; // e.g. https://script.google.com/macros/s/XXXX/exec

  const roundTag = document.getElementById('roundTag');
  const list = document.getElementById('matchList');
  const empty = document.getElementById('emptyState');

  async function loadFromAPI() {
    try {
      const res = await fetch(API_BASE + "?path=activeRound", { credentials: "omit" });
      const data = await res.json();
      if (data && data.ok && Array.isArray(data.matches) && data.matches.length) {
        roundTag.textContent = data.round ? `Round ${data.round}` : 'Round —';
        list.innerHTML = data.matches.map(m => `<li class="match"><span class="name">${m}</span><span class="meta"><span class="chip blue">Open</span></span></li>`).join('');
        return true;
      }
      return false;
    } catch (e) {
      console.warn("API failed, falling back to URL params.", e);
      return false;
    }
  }

  function loadFromQuery() {
    const params = new URLSearchParams(window.location.search);
    const round = params.get('round') || '';
    const raw = params.get('matches') || '';
    const matches = raw ? raw.split('|').filter(Boolean) : [];
    roundTag.textContent = round ? `Round ${round}` : 'Round —';
    if (matches.length) {
      list.innerHTML = matches.map(m => `<li class="match"><span class="name">${m}</span></li>`).join('');
      return true;
    }
    return false;
  }

  (async function init(){
    const ok = await loadFromAPI();
    if (!ok) {
      const ok2 = loadFromQuery();
      if (!ok2) empty.classList.remove('hidden');
    }
  })();
</script>
